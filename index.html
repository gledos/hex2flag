<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>hex2flag</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        body.dark-mode {
            background-color: #2b2b2b;
            color: #ffffff;
        }

        body.dark-mode a {
            color: #bb86fc;
        }

        body.transitioning {
            transition: background-color 0.3s, color 0.3s;
        }

        #header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        #languageSelector {
            align-items: right;
            margin-top: 10px;
        }

        @media only screen and (max-width: 600px) {
            /* Styles for screens smaller than 600px */
            body {
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div id="header">
        <h1>hex2flag</h1>
        <div>
            <label for="languageSelector">ğŸŒ</label>
            <select id="languageSelector" onchange="changeLanguage()">
                <option value="en">English</option>
                <option value="zh-CN">ç®€ä½“ä¸­æ–‡</option>
                <option value="zh-TW">ç¹é«”ä¸­æ–‡</option>
                <option value="ja">æ—¥æœ¬èª</option>
            </select>
            <button onclick="toggleDarkMode()">ğŸŒï¼ğŸŒ‘</button>
        </div>
    </div>

    <label id="hexInputLabel" for="hexInput">${languages[currentLanguage].enterHex}</label>
    <input type="text" id="hexInput" placeholder="Enter Hexadecimal" style="width: 300px;"
        onkeypress="if(event.keyCode===13) formatHex()">

    <button id="formatBtn" onclick="formatHex()">${languages[currentLanguage].formatBtn}</button>

    <select id="flagRatioSelector">
        <option value="flag_2_3">2:3 â†’ (300Ã—200 px)</option>
        <option value="flag_3_4">3:4 â†’ (400Ã—300 px)</option>
        <option value="avatar">avatar â†’ (640Ã—640 px)</option>
        <option value="flag_2_3_td">2:3 â†“ (300Ã—200 px)</option>
    </select>

    <p id="formattedHex"></p>
    <hr>
    <div id="flag-container">
        <div id="flag"></div>
    </div>

    <!-- ä¸‹è½½æŒ‰é’® -->
    <button id="downloadBtn" onclick="downloadSVG()" style="display: none;">${languages[currentLanguage].downloadBtn}</button>

    <!-- æ·»åŠ ç®€ä»‹ -->
    <div id="introContainer">
        <p id="intro">
            <!-- This content will be dynamically replaced by JavaScript based on the selected language. -->
        </p>
    </div>

    <script>
        // è·å–æˆ–è®¾ç½®æš—è‰²æ¨¡å¼çŠ¶æ€
        // Get or set dark mode status
        function getDarkMode() {
            return localStorage.getItem("darkMode") === "true";
        }

        function setDarkMode(value) {
            localStorage.setItem("darkMode", value);
        }

        // åˆ‡æ¢æš—è‰²æ¨¡å¼
        // Toggle dark mode
        function toggleDarkMode() {
            const body = document.body;
            const darkMode = getDarkMode();
            body.classList.toggle("dark-mode", !darkMode);
            setDarkMode(!darkMode);
        }

        // åˆå§‹åŒ–é¡µé¢æ—¶è‡ªåŠ¨é€‚é…æš—è‰²æ¨¡å¼
        // Automatically adapt to dark mode when initializing the page
        function autoAdjustDarkMode() {
            const body = document.body;
            const prefersDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches;
            const storedDarkMode = getDarkMode();

            if (storedDarkMode !== null) {
                body.classList.toggle("dark-mode", storedDarkMode);
            } else {
                body.classList.toggle("dark-mode", prefersDarkMode);
                setDarkMode(prefersDarkMode);
            }
        }

        // åœ¨é¡µé¢åŠ è½½æ—¶è°ƒç”¨ autoAdjustDarkMode
        // Call autoAdjustDarkMode on page load
        document.addEventListener("DOMContentLoaded", function () {
            autoAdjustDarkMode();
        });

        const flagInfo = {
            flag_2_3: {direction: "lr", width: 300,height: 200,textX: 290,textY: 190,fontSize: 15,fontFamily: "monospace",textAnchor: "end",alignmentBaseline: "bottom"},
            flag_3_4: {direction: "lr", width: 400,height: 300,textX: 390,textY: 290,fontSize: 22,fontFamily: "monospace",textAnchor: "end",alignmentBaseline: "bottom"},
            avatar: {direction: "lr", width: 640,height: 640,textX: 320, textY: 320, fontSize: 80,fontFamily: "monospace",textAnchor: "middle", alignmentBaseline: "middle"},
            flag_2_3_td: {direction: "td", width: 300,height: 200,textX: 290,textY: 190,fontSize: 15,fontFamily: "monospace",textAnchor: "end",alignmentBaseline: "bottom"},
        };

        let currentFlagType = "flag_2_3"; // é»˜è®¤é€‰æ‹©æ——å¸œï¼ˆ2:3ï¼‰
                                          // Default selection flag (2:3)

        // æ ¼å¼åŒ– Hexã€ç”Ÿæˆ SVG æ——å¸œå¹¶æ˜¾ç¤º
        // Format Hex, generate SVG flag, and display
        function formatHex() {
            const hexInput = document.getElementById("hexInput").value.replace(/[\s\-#+,:]/g, "");
            const formattedHexDiv = document.getElementById("formattedHex");
            const flagDiv = document.getElementById("flag");
            const flagColors = [];
            let flagText = null;
            let textColor = "#000000";

            // éªŒè¯è¾“å…¥æ˜¯å¦ä¸ºæœ‰æ•ˆçš„åå…­è¿›åˆ¶æ•°å­—
            // Validate if the input is a valid hexadecimal number
            if (!hexInput.match(/^0x[0-9A-Fa-f]+$/) && !hexInput.match(/^[0-9A-Fa-f]+$/)) {
                alert("Please enter a valid hexadecimal number.");
                return;
            }

            // ç§»é™¤å¯èƒ½çš„ "0x" å‰ç¼€
            // Remove possible "0x" prefix
            const sanitizedHex = hexInput.startsWith("0x") ? hexInput.slice(2) : hexInput;

            // æ£€æŸ¥Hexæ˜¯å¦è¶³å¤Ÿé•¿
            // Check if Hex is long enough
            if (sanitizedHex.length < 6) {
                alert("Hexadecimal input should be at least 6 characters long.");
                return;
            }

            const flagType = document.getElementById("flagRatioSelector").value;
            currentFlagType = flagType;

            // è·å–å½“å‰é€‰ä¸­æ——å¸œç±»å‹çš„å‚æ•°
            // Get parameters for the currently selected flag type
            const currentFlagInfo = flagInfo[currentFlagType];

            // è®¡ç®—é¢œè‰²å—çš„æ•°é‡å’Œå®½åº¦
            // Calculate the number of color blocks and width
            const numColors = sanitizedHex.length / 6;
            var colorWidth = 1;
            switch (currentFlagInfo.direction) {
                case 'lr':
                colorWidth = currentFlagInfo.width / (Math.floor(numColors));
                break;

                case 'lr':
                colorWidth = currentFlagInfo.width / (Math.floor(numColors));
                break;

                case 'td':
                colorWidth = currentFlagInfo.height / (Math.floor(numColors));
                break;

                case 'dt':
                colorWidth = currentFlagInfo.height / (Math.floor(numColors));
                break;

                default:
                colorWidth = currentFlagInfo.width / (Math.floor(numColors));
                break;
            }

            // const colorWidth = currentFlagInfo.width / (Math.floor(sanitizedHex.length / 6));

            // æå–é¢œè‰²å—å’Œ flagText
            // Extract color blocks and flagText
            for (let i = 0; i < numColors; i++) {
                const startIdx = i * 6;
                const endIdx = startIdx + 6;
                const color = sanitizedHex.slice(startIdx, endIdx);

                if (color.length === 6) {
                    flagColors.push(color);
                } else if (color.length > 0 && color.length < 6) {
                    flagText = "+" + color;
                }
            }

            // è®¡ç®—æœ€åä¸€ä¸ªé¢œè‰²å—çš„äº®åº¦
            // Calculate brightness of the last color block
            if (flagColors.length > 0) {
                const lastColor = flagColors[flagColors.length - 1];
                textColor = getTextColor(lastColor);
            }

            // ç”Ÿæˆ SVG å†…å®¹
            // Generate SVG content
            var svgContent;
            switch (currentFlagInfo.direction) {
                case 'lr':
                svgContent = `<svg xmlns="http://www.w3.org/2000/svg" height="${currentFlagInfo.height}px" width="${currentFlagInfo.width}px" id="freeSpeechFlag">
${flagColors.map((color, index) => `<rect x="${index * colorWidth}" width="${colorWidth}px" height="${currentFlagInfo.height}" fill="#${color}"/>`).join('')}
<text x="${currentFlagInfo.textX}px" y="${currentFlagInfo.textY}px" font-size="${currentFlagInfo.fontSize}px"
font-family="${currentFlagInfo.fontFamily}" text-anchor="${currentFlagInfo.textAnchor}"
alignment-baseline="${currentFlagInfo.alignmentBaseline}" fill="${textColor}">${flagText || ""}</text></svg>`;
                break;

                case 'lr':

                break;

                case 'td':
                svgContent = `<svg xmlns="http://www.w3.org/2000/svg" height="${currentFlagInfo.height}px" width="${currentFlagInfo.width}px" id="freeSpeechFlag">
${flagColors.map((color, index) => `<rect y="${index * colorWidth}" width="${currentFlagInfo.width}" height="${colorWidth}px" fill="#${color}"/>`).join('')}
<text x="${currentFlagInfo.textX}px" y="${currentFlagInfo.textY}px" font-size="${currentFlagInfo.fontSize}px"
font-family="${currentFlagInfo.fontFamily}" text-anchor="${currentFlagInfo.textAnchor}"
alignment-baseline="${currentFlagInfo.alignmentBaseline}" fill="${textColor}">${flagText || ""}</text></svg>`;
                break;

                case 'dt':
                break;

                default:
                break;
            }


            // æ˜¾ç¤º SVG æ——å¸œå’Œæ ¼å¼åŒ–åçš„ Hex
            // Display SVG flag and formatted Hex
            flagDiv.innerHTML = svgContent;
            const formattedColors = flagColors.map(color => `#${color}`).join(' ');
            formattedHexDiv.textContent = flagText ? `${formattedColors} ${flagText}` : formattedColors;

            // æ˜¾ç¤ºæˆ–éšè—ä¸‹è½½æŒ‰é’®
            // Show or hide the download button
            const downloadBtn = document.getElementById("downloadBtn");
            if (flagColors.length > 0) {
                downloadBtn.style.display = "block";
            } else {
                downloadBtn.style.display = "none";
            }

        }


        // è®¡ç®—é¢œè‰²äº®åº¦
        // Calculate color brightness
        function calculateLuminance(hexColor) {
            const rgb = hexToRgb(hexColor);
            return (0.299 * rgb.r + 0.587 * rgb.g + 0.114 * rgb.b) / 255;
        }

        // å°†åå…­è¿›åˆ¶é¢œè‰²è½¬æ¢ä¸º RGB æ ¼å¼
        // Convert hexadecimal color to RGB format
        function hexToRgb(hex) {
            const bigint = parseInt(hex.slice(1), 16);
            const r = (bigint >> 16) & 255;
            const g = (bigint >> 8) & 255;
            const b = bigint & 255;
            return { r, g, b };
        }

        // è·å–æ–‡æœ¬é¢œè‰²
        // Get text color
        function getTextColor(hexColor) {
            const luminance = calculateLuminance(hexColor);
            return luminance > 0.5 ? "#000000" : "#FFFFFF";
        }

        // ä¸‹è½½ SVG å‡½æ•°
        // Download SVG function
        function downloadSVG() {
            const hexInput = document.getElementById("hexInput").value.trim().replace(/^0x/i, ''); // Remove "0x" prefix
            const sanitizedHex = hexInput.replace(/[\s\-#+,:]/g, "").toUpperCase(); // Remove unwanted characters and convert to uppercase
            const svgContent = document.getElementById("freeSpeechFlag").outerHTML;
            const blob = new Blob([svgContent], { type: "image/svg+xml" });
            const url = URL.createObjectURL(blob);

            const fileName = `${sanitizedHex}_Flag.svg`;

            const a = document.createElement("a");
            a.href = url;
            a.download = fileName;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        // å¤šè¯­è¨€æ”¯æŒ
        // Multilingual support
        const languages = {
            en: {
                enterHex: "Enter Hexadecimal:",
                formatBtn: "Format",
                downloadBtn: "Download SVG",
                intro: `On May 1, 2007, the Digg social platform also faced actions related to the DMCA,
initiating deletions and account removals related to the dissemination of keys. At that time,
people continuously employed creative methods to disguise the keys, including the creation of
flags using hexadecimal RGB numbers.</p><p>For example, transforming the key <code>09F911029D74E35BD84156C5635688C0</code> into
<code>#09F911 #029D74 #E35BD8 #4156C5 #635688 +C0</code> formed the
<a href="https://en.wikipedia.org/wiki/Free_Speech_Flag" target="_blank">Free Speech Flag</a>.</p>
<p>The GitHubrepository for this hex2flag tool (Free Speech Flag Generator) is located at:
<a href="https://github.com/gledos/hex2flag" target="_blank">https://github.com/gledos/hex2flag</a>`
            },
            "zh-CN": {
                enterHex: "è¾“å…¥åå…­è¿›åˆ¶:",
                formatBtn: "ç”Ÿæˆ",
                downloadBtn: "ä¸‹è½½ SVG",
                intro: `2007å¹´5æœˆ1æ—¥ï¼ŒDigg ç¤¾äº¤å¹³å°ä¹Ÿå› ä¸º DMCAï¼Œå¼€å§‹é’ˆå¯¹å¯†é’¥ä¼ æ’­åˆ è´´ã€åˆ å·ã€‚
ç„¶åå½“æ—¶çš„äººä»¬ä¸æ–­ä½¿ç”¨åˆ›é€ æ€§çš„æ–¹æ³•æ¥ä¼ªè£…å¯†é’¥ï¼Œå…¶ä¸­å°±æœ‰ä½¿ç”¨åå…­è¿›åˆ¶æ•°å­—çš„ RGB åˆ¶ä½œçš„æ——å¸œã€‚</p><p>æ¯”å¦‚å°†å¯†é’¥
<code>09F911029D74E35BD84156C5635688C0</code> æ”¹å†™ä¸º <code>#09F911 #029D74 #E35BD8 #4156C5 #635688 +C0</code>ï¼Œ
ç„¶åå°±ç»„æˆäº† <a href="https://en.wikipedia.org/wiki/Free_Speech_Flag" target="_blank">è¨€è®ºè‡ªç”±ä¹‹æ——</a>ã€‚</p>
<p>æ­¤ hex2flag å·¥å…·ï¼ˆè¨€è®ºè‡ªç”±æ——å¸œç”Ÿæˆå™¨ï¼‰çš„ GitHub ä»“åº“åœ°å€ä¸ºï¼š<a href="https://github.com/gledos/hex2flag"
target="_blank">https://github.com/gledos/hex2flag</a>`
            },
            "zh-TW": {
                enterHex: "è¼¸å…¥åå…­é€²åˆ¶ï¼š",
                formatBtn: "ç”Ÿæˆ",
                downloadBtn: "ä¸‹è¼‰ SVG",
                intro: `2007å¹´5æœˆ1æ—¥ï¼ŒDigg ç¤¾äº¤å¹³å°ä¹Ÿå›  DMCA å¼€å§‹é‡å°å¯†é‘°å‚³æ’­é€²è¡Œåˆªå¸–ã€å°è™Ÿã€‚
ç•¶æ™‚äººå€‘ä¸æ–·ä½¿ç”¨å‰µé€ æ€§çš„æ–¹æ³•ä¾†å½è£å¯†é‘°ï¼Œå…¶ä¸­å°±æœ‰ä½¿ç”¨åå…­é€²åˆ¶æ•¸å­—çš„ RGB è£½ä½œçš„æ——å¹Ÿã€‚</p><p>ä¾‹å¦‚ï¼Œå°‡å¯†é‘°
<code>09F911029D74E35BD84156C5635688C0</code> æ”¹å¯«ç‚º <code>#09F911 #029D74 #E35BD8 #4156C5 #635688 +C0</code>ï¼Œ
ç„¶å¾Œå°±çµ„æˆäº† <a href="https://en.wikipedia.org/wiki/Free_Speech_Flag" target="_blank">è¨€è«–è‡ªç”±ä¹‹æ——</a>ã€‚</p>
<p>æ­¤ hex2flag å·¥å…·ï¼ˆè¨€è«–è‡ªç”±æ——å¹Ÿç”Ÿæˆå™¨ï¼‰çš„ GitHub å€‰åº«åœ°å€ç‚ºï¼š<a href="https://github.com/gledos/hex2flag"
target="_blank">https://github.com/gledos/hex2flag</a>`
            },
            ja: { // japanese
                enterHex: "16 é€²æ•°ã‚’å…¥åŠ›:",
                formatBtn: "ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ",
                downloadBtn: "SVG ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰",
                intro: `2007å¹´5æœˆ1æ—¥ã€Digg ã‚½ãƒ¼ã‚·ãƒ£ãƒ«ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‚‚ DMCA ã«é–¢é€£ã—ã¦éµã®æµå¸ƒã«å¯¾å‡¦ã—ã€
å‰Šé™¤ã‚„ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®å‰Šé™¤ãŒå§‹ã¾ã‚Šã¾ã—ãŸã€‚ãã®å½“æ™‚ã€äººã€…ã¯éµã‚’å½è£…ã™ã‚‹ãŸã‚ã«å‰µé€ çš„ãªæ–¹æ³•ã‚’ç¶™ç¶šçš„ã«ä½¿ç”¨ã—ã€
ãã®ä¸­ã«ã¯ 16 é€²æ•°ã® RGB ã‚’ä½¿ç”¨ã—ã¦ä½œæˆã•ã‚ŒãŸæ——ã‚‚å«ã¾ã‚Œã¦ã„ã¾ã™ã€‚</p><p>ä¾‹ãˆã°ã€éµ
</code>09F911029D74E35BD84156C5635688C0</code> ã‚’ </code>#09F911 #029D74 #E35BD8 #4156C5 #635688 +C0</code>
ã«å¤‰æ›ã™ã‚‹ã“ã¨ã§ã€<a href="https://en.wikipedia.org/wiki/Free_Speech_Flag" target="_blank">Free Speech Flag</a>
ã®ãŒå½¢æˆã•ã‚Œã¾ã—ãŸã€‚</p>
<p>ã“ã® hex2flag ãƒ„ãƒ¼ãƒ«ï¼ˆFree Speech Flag Generatorï¼‰ã® GitHub ãƒªãƒã‚¸ãƒˆãƒªã¯æ¬¡ã«ã‚ã‚Šã¾ã™ï¼š<a
href="https://github.com/gledos/hex2flag" target="_blank">https://github.com/gledos/hex2flag</a>`
            },
        };

        // Variable to track the current language
        let currentLanguage = localStorage.getItem("selectedLanguage") || "en";

        // Function to change the language
        function changeLanguage() {
            const newLanguage = document.getElementById("languageSelector").value;
            document.documentElement.lang = newLanguage; // Set the lang attribute of the html tag
            currentLanguage = newLanguage;
            localStorage.setItem("selectedLanguage", currentLanguage);
            updateUI();

            // Reload the page
            // location.reload();
        };

        // Function to update the UI based on the current language
        function updateUI() {
            const language = languages[currentLanguage];

            // Update HTML elements with language-specific text
            document.getElementById("hexInputLabel").textContent = language.enterHex;
            document.getElementById("formatBtn").textContent = language.formatBtn;
            document.getElementById("downloadBtn").textContent = language.downloadBtn;
            document.getElementById("intro").innerHTML = language.intro;
            intro
        };
        updateUI();

        // å»¶è¿Ÿæ·»åŠ å˜è‰²æ¸å˜åŠŸèƒ½
        // Delayed addition of color transition effect
        setTimeout(function() {
            document.body.classList.add("transitioning");
        }, 500); // 500 ms
    </script>
</body>
</html>
